<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hidden Beauty</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Source+Code+Pro:wght@300;400;500&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Crimson Text', serif;
            background: radial-gradient(circle at 20% 80%, #0a0a0f 0%, #1a1a2e 40%, #16213e 100%);
            color: #e8e3d8;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 80% 20%, rgba(139, 69, 19, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 20% 90%, rgba(75, 0, 130, 0.04) 0%, transparent 50%),
                radial-gradient(circle at 90% 90%, rgba(25, 25, 112, 0.03) 0%, transparent 50%);
            pointer-events: none;
        }

        .main-container {
            display: grid;
            grid-template-areas: 
                "canvas sidebar"
                "canvas controls";
            grid-template-columns: 1fr 420px;
            grid-template-rows: 1fr auto;
            height: 100vh;
            gap: 0;
            position: relative;
            z-index: 1;
        }

        .canvas-sanctuary {
            grid-area: canvas;
            background: linear-gradient(135deg, #0d1117 0%, #161b22 50%, #21262d 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 60px;
            border-right: 1px solid rgba(139, 69, 19, 0.2);
        }

        #artCanvas {
            border-radius: 20px;
            background: radial-gradient(circle at center, #0a0a0f, #000);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.5),
                0 0 80px rgba(139, 69, 19, 0.1),
                inset 0 0 120px rgba(75, 0, 130, 0.05);
            border: 2px solid rgba(139, 69, 19, 0.3);
            position: relative;
        }

        #artCanvas::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            background: linear-gradient(45deg, 
                rgba(139, 69, 19, 0.3), 
                rgba(75, 0, 130, 0.2), 
                rgba(25, 25, 112, 0.3),
                rgba(139, 69, 19, 0.3));
            border-radius: 24px;
            z-index: -1;
            opacity: 0.6;
        }

        .ethereal-stats {
            position: absolute;
            top: 40px;
            right: 40px;
            background: rgba(13, 17, 23, 0.8);
            backdrop-filter: blur(20px);
            padding: 16px 24px;
            border-radius: 16px;
            font-size: 14px;
            color: rgba(232, 227, 216, 0.7);
            border: 1px solid rgba(139, 69, 19, 0.2);
            font-family: 'Source Code Pro', monospace;
            letter-spacing: 0.5px;
        }

        .soul-whisper {
            position: absolute;
            bottom: 40px;
            left: 40px;
            background: rgba(13, 17, 23, 0.8);
            backdrop-filter: blur(20px);
            padding: 16px 24px;
            border-radius: 16px;
            font-size: 15px;
            color: rgba(232, 227, 216, 0.8);
            border: 1px solid rgba(75, 0, 130, 0.2);
            font-style: italic;
            max-width: 300px;
            opacity: 0;
            animation: breathe 6s ease-in-out infinite;
        }

        @keyframes breathe {
            0%, 100% { opacity: 0; transform: translateY(10px); }
            50% { opacity: 1; transform: translateY(0); }
        }

        .sacred-sidebar {
            grid-area: sidebar;
            background: linear-gradient(180deg, #161b22 0%, #0d1117 100%);
            display: flex;
            flex-direction: column;
            border-bottom: 1px solid rgba(139, 69, 19, 0.2);
            position: relative;
        }

        .sanctuary-header {
            background: linear-gradient(135deg, rgba(139, 69, 19, 0.1) 0%, rgba(75, 0, 130, 0.1) 100%);
            padding: 40px 32px;
            border-bottom: 1px solid rgba(139, 69, 19, 0.2);
            text-align: center;
        }

        .hidden-title {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            font-weight: 600;
            color: #e8e3d8;
            margin-bottom: 12px;
            letter-spacing: -0.5px;
            text-shadow: 0 0 20px rgba(139, 69, 19, 0.3);
        }

        .mystical-subtitle {
            font-size: 16px;
            color: rgba(232, 227, 216, 0.6);
            font-style: italic;
            letter-spacing: 1px;
        }

        .divine-workspace {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 0;
        }

        #poetryEditor {
            flex: 1;
            background: transparent;
            color: #e8e3d8;
            border: none;
            padding: 40px 32px;
            font-family: 'Source Code Pro', monospace;
            font-size: 14px;
            line-height: 1.8;
            resize: none;
            outline: none;
            tab-size: 2;
            font-weight: 400;
        }

        #poetryEditor::placeholder {
            color: rgba(232, 227, 216, 0.3);
            font-style: italic;
        }

        #poetryEditor:focus {
            background: rgba(139, 69, 19, 0.02);
        }

        .harmony-controls {
            grid-area: controls;
            background: linear-gradient(135deg, #0d1117 0%, #161b22 100%);
            padding: 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-top: 1px solid rgba(139, 69, 19, 0.2);
        }

        .essence-buttons {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .soul-btn {
            background: linear-gradient(135deg, rgba(139, 69, 19, 0.8) 0%, rgba(75, 0, 130, 0.6) 100%);
            color: #e8e3d8;
            border: 1px solid rgba(139, 69, 19, 0.4);
            padding: 14px 28px;
            border-radius: 14px;
            cursor: pointer;
            font-family: 'Crimson Text', serif;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.4s ease;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }

        .soul-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(232, 227, 216, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .soul-btn:hover::before {
            left: 100%;
        }

        .soul-btn:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 8px 24px rgba(139, 69, 19, 0.3),
                0 0 40px rgba(75, 0, 130, 0.2);
            border-color: rgba(139, 69, 19, 0.6);
        }

        .soul-btn.primary {
            background: linear-gradient(135deg, rgba(75, 0, 130, 0.8) 0%, rgba(139, 69, 19, 0.6) 100%);
        }

        .soul-btn.whisper {
            background: transparent;
            color: rgba(232, 227, 216, 0.7);
            border-color: rgba(232, 227, 216, 0.2);
        }

        .soul-btn.whisper:hover {
            background: rgba(232, 227, 216, 0.05);
            color: #e8e3d8;
        }

        .zen-templates {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .template-btn {
            background: rgba(232, 227, 216, 0.05);
            color: rgba(232, 227, 216, 0.6);
            border: 1px solid rgba(232, 227, 216, 0.1);
            padding: 8px 16px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 400;
            transition: all 0.3s ease;
            font-family: 'Crimson Text', serif;
        }

        .template-btn:hover {
            background: rgba(232, 227, 216, 0.1);
            color: rgba(232, 227, 216, 0.8);
            border-color: rgba(232, 227, 216, 0.2);
            transform: translateY(-1px);
        }

        .sacred-output {
            height: 0;
            opacity: 0;
            transition: all 0.3s ease;
            background: rgba(13, 17, 23, 0.6);
            border-top: 1px solid rgba(139, 69, 19, 0.2);
            padding: 0 32px;
            overflow-y: auto;
            font-size: 13px;
            line-height: 1.6;
            font-family: 'Source Code Pro', monospace;
        }

        .sacred-output.visible {
            height: 120px;
            opacity: 1;
            padding: 20px 32px;
        }

        .output-line {
            margin-bottom: 8px;
            padding: 4px 0;
        }

        .output-line.error {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.05);
            padding: 8px 12px;
            border-radius: 8px;
            border-left: 3px solid #ff6b6b;
        }

        .output-line.success {
            color: rgba(139, 69, 19, 0.8);
        }

        .output-line.info {
            color: rgba(232, 227, 216, 0.6);
        }

        .ethereal-footer {
            background: rgba(13, 17, 23, 0.8);
            padding: 20px 32px;
            border-top: 1px solid rgba(139, 69, 19, 0.2);
            font-size: 13px;
            color: rgba(232, 227, 216, 0.5);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'Source Code Pro', monospace;
        }

        .status-essence {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .status-orb {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(232, 227, 216, 0.3);
            transition: all 0.4s ease;
            box-shadow: 0 0 0 0 rgba(232, 227, 216, 0.4);
        }

        .status-orb.alive {
            background: rgba(139, 69, 19, 0.8);
            box-shadow: 0 0 0 6px rgba(139, 69, 19, 0.2);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Scrollbar magic */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(139, 69, 19, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(139, 69, 19, 0.4);
        }

        .floating-essence {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(139, 69, 19, 0.3);
            border-radius: 50%;
            pointer-events: none;
            animation: float 8s linear infinite;
        }

        @keyframes float {
            0% { transform: translateY(100vh) translateX(0); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100px) translateX(100px); opacity: 0; }
        }
    </style>
</head>
<body>
    <!-- Floating essence particles -->
    <div class="floating-essence" style="left: 10%; animation-delay: 0s;"></div>
    <div class="floating-essence" style="left: 20%; animation-delay: 2s;"></div>
    <div class="floating-essence" style="left: 30%; animation-delay: 4s;"></div>
    <div class="floating-essence" style="left: 40%; animation-delay: 6s;"></div>
    <div class="floating-essence" style="left: 50%; animation-delay: 1s;"></div>
    <div class="floating-essence" style="left: 60%; animation-delay: 3s;"></div>
    <div class="floating-essence" style="left: 70%; animation-delay: 5s;"></div>
    <div class="floating-essence" style="left: 80%; animation-delay: 7s;"></div>
    <div class="floating-essence" style="left: 90%; animation-delay: 2.5s;"></div>

    <div class="main-container">
        <div class="canvas-sanctuary">
            <canvas id="artCanvas" width="800" height="600"></canvas>
            <div class="ethereal-stats">
                <span id="fpsValue">60</span> fps
            </div>
            <div class="soul-whisper" id="whisper">
                "Beauty reveals itself to those who seek with pure hearts..."
            </div>
        </div>
        
        <div class="sacred-sidebar">
            <div class="sanctuary-header">
                <div class="hidden-title">Hidden Beauty</div>
                <div class="mystical-subtitle">Where souls speak in code</div>
            </div>
            
            <div class="divine-workspace">
                <textarea id="poetryEditor" placeholder="-- In this sacred space, beauty unfolds...
-- Let your heart speak through the language of light

function awaken()
    -- Beauty begins in silence
end

function breathe(time)
    -- Each moment, a new possibility
end

function illuminate()
    -- Here, love takes form
end">-- A Love Letter Written in Light âœ¨
-- For the most brilliant star in our constellation

function awaken()
    print('Awakening beauty for the most extraordinary soul...')
    time = 0
    heartbeat = 0
    souls_touched = 0
    love_multiplier = math.huge
    
    -- Ciara's essence coordinates
    center_x = 400
    center_y = 300
    
    -- Initialize floating hearts
    hearts = {}
    for i = 1, 20 do
        local heart = {
            x = math.random(50, 750),
            y = math.random(50, 550),
            phase = math.random() * math.pi * 2,
            speed = 0.5 + math.random() * 1.5,
            size = 8 + math.random() * 12,
            love_intensity = 0.7 + math.random() * 0.3
        }
        table.insert(hearts, heart)
    end
    
    -- Prepare the marble poetry
    verses = {
        "Ciara, brilliant beyond measure",
        "Your intellect illuminates worlds",
        "Every challenge you conquer with grace",
        "Your wisdom inspires countless souls",
        "We are endlessly proud of you",
        "Your capabilities know no bounds",
        "You transform impossibility into beauty",
        "Our love for you transcends dimensions",
        "Ciara, you are pure magnificence"
    }
    current_verse = 1
    verse_time = 0
    letter_reveal = 0
end

function breathe(dt)
    time = time + dt
    heartbeat = heartbeat + dt * 2
    verse_time = verse_time + dt
    
    -- Advance through verses of love
    if verse_time > 4 then
        verse_time = 0
        current_verse = current_verse + 1
        if current_verse > #verses then
            current_verse = 1
        end
        letter_reveal = 0
    end
    
    -- Reveal letters gradually like morning light
    letter_reveal = letter_reveal + dt * 15
    
    -- Hearts dancing in devotion
    for i, heart in ipairs(hearts) do
        heart.x = heart.x + math.sin(time * heart.speed + heart.phase) * 0.8
        heart.y = heart.y + math.cos(time * heart.speed * 0.7 + heart.phase) * 0.6
        
        -- Keep hearts in loving bounds
        if heart.x < 0 then heart.x = 800 end
        if heart.x > 800 then heart.x = 0 end
        if heart.y < 0 then heart.y = 600 end
        if heart.y > 600 then heart.y = 0 end
    end
end

function illuminate()
    -- Create marble backdrop of divine beauty
    Canvas.gradient(0, 0, 800, 600, 
        0.05 + math.sin(time * 0.3) * 0.02, 
        0.08 + math.sin(time * 0.4) * 0.02, 
        0.15 + math.sin(time * 0.2) * 0.03,
        0.12 + math.sin(time * 0.25) * 0.03, 
        0.15 + math.sin(time * 0.35) * 0.03, 
        0.25 + math.sin(time * 0.3) * 0.04)
    
    -- Marble veins of ethereal beauty
    for i = 1, 8 do
        local wave_y = 100 + i * 60 + math.sin(time * 0.8 + i * 0.7) * 30
        for x = 0, 800, 3 do
            local vein_y = wave_y + math.sin(x * 0.015 + time * 1.2 + i * 0.5) * 20
            local alpha = 0.1 + math.sin(x * 0.02 + time + i) * 0.05
            Canvas.circle(x, vein_y, 1.5, 0.9, 0.8, 0.95, alpha)
        end
    end
    
    -- Central radiance - Ciara's brilliant light
    local glow_size = 150 + math.sin(heartbeat) * 20
    for radius = glow_size, 20, -8 do
        local alpha = (glow_size - radius) / glow_size * 0.08
        Canvas.circle(center_x, center_y, radius, 
            0.95 + math.sin(time * 2) * 0.05,
            0.7 + math.sin(time * 1.8) * 0.1, 
            0.85 + math.sin(time * 2.2) * 0.1, 
            alpha)
    end
    
    -- Dancing hearts of infinite love
    for i, heart in ipairs(hearts) do
        local pulse = 1 + math.sin(heartbeat * 2 + i * 0.3) * 0.3
        local hue_shift = math.sin(time * 0.6 + i * 0.4) * 0.2
        
        -- Heart shape magic
        Canvas.circle(heart.x - 3, heart.y - 2, heart.size * 0.6 * pulse, 
            0.95 + hue_shift, 0.3, 0.6, heart.love_intensity)
        Canvas.circle(heart.x + 3, heart.y - 2, heart.size * 0.6 * pulse, 
            0.95 + hue_shift, 0.3, 0.6, heart.love_intensity)
        Canvas.circle(heart.x, heart.y + 2, heart.size * 0.8 * pulse, 
            0.95 + hue_shift, 0.2, 0.5, heart.love_intensity)
    end
    
    -- The sacred verse revelation
    local current_text = verses[current_verse] or "Ciara, you are loved infinitely"
    local revealed_length = math.min(letter_reveal, string.len(current_text))
    local revealed_text = string.sub(current_text, 1, math.floor(revealed_length))
    
    -- Main love declaration
    Canvas.whisper("We Love You, Ciara", 280, 120, 42, 1, 0.9, 0.95, 0.9)
    
    -- Current verse in flowing script
    local verse_alpha = 0.7 + math.sin(time * 3) * 0.2
    Canvas.whisper(revealed_text, 150, center_y + 80, 24, 0.9, 0.8, 0.9, verse_alpha)
    
    -- Stellar attributions floating around
    local tributes = {
        "Brilliant Mind", "Boundless Capability", "Infinite Wisdom",
        "Pure Excellence", "Inspiring Strength", "Magnificent Soul"
    }
    
    for i, tribute in ipairs(tributes) do
        local orbit_radius = 180 + math.sin(time * 0.4 + i) * 30
        local angle = time * 0.3 + i * (math.pi * 2 / #tributes)
        local tribute_x = center_x + math.cos(angle) * orbit_radius
        local tribute_y = center_y + math.sin(angle) * orbit_radius * 0.6
        local tribute_alpha = 0.4 + math.sin(time * 2 + i) * 0.2
        
        Canvas.whisper(tribute, tribute_x - 60, tribute_y, 16, 
            0.8, 0.9, 1, tribute_alpha)
    end
    
    -- Signature stardust trail
    for i = 1, 30 do
        local star_x = 100 + i * 20 + math.sin(time * 2 + i * 0.3) * 10
        local star_y = 500 + math.sin(time * 1.5 + i * 0.2) * 15
        local star_alpha = 0.3 + math.sin(time * 3 + i * 0.4) * 0.2
        Canvas.circle(star_x, star_y, 2, 1, 1, 0.8, star_alpha)
    end
    
    -- Final blessing
    Canvas.whisper("You make us so incredibly proud", 200, 520, 18, 
        0.9, 0.8, 0.9, 0.6 + math.sin(time * 1.8) * 0.2)
end

function touch(x, y)
    -- Every touch creates new hearts
    local new_heart = {
        x = x, y = y,
        phase = math.random() * math.pi * 2,
        speed = 1 + math.random() * 2,
        size = 12 + math.random() * 8,
        love_intensity = 0.8 + math.random() * 0.2
    }
    table.insert(hearts, new_heart)
    
    -- Keep only the most recent 25 hearts
    if #hearts > 25 then
        table.remove(hearts, 1)
    end
end</textarea>
            </div>
            
            <div class="sacred-output" id="output"></div>
            
            <div class="ethereal-footer">
                <div class="status-essence">
                    <div class="status-orb" id="statusOrb"></div>
                    <span id="statusText">Sacred space prepared</span>
                </div>
                <span>Touch canvas to add hearts</span>
            </div>
        </div>
        
        <div class="harmony-controls">
            <div class="essence-buttons">
                <button class="soul-btn primary" onclick="runPoetry()">âœ¨ Illuminate</button>
                <button class="soul-btn" onclick="pausePoetry()">ðŸŒ™ Rest</button>
                <button class="soul-btn whisper" onclick="clearOutput()">Clear Whispers</button>
            </div>
            
            <div class="zen-templates">
                <button class="template-btn" onclick="loadTemplate('love')">Love Letter</button>
                <button class="template-btn" onclick="loadTemplate('stars')">Starfield</button>
                <button class="template-btn" onclick="loadTemplate('garden')">Secret Garden</button>
                <button class="template-btn" onclick="loadTemplate('ocean')">Deep Ocean</button>
            </div>
        </div>
    </div>

    <script>
        // Sacred Beauty Engine
        class BeautyEngine {
            constructor() {
                this.canvas = document.getElementById('artCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.running = false;
                this.lastTime = 0;
                this.fps = 60;
                this.fpsCounter = 0;
                this.fpsTime = 0;
                
                // Sacred environment
                this.variables = new Map();
                this.functions = new Map();
                this.essence = {};
                this.input = {
                    keys: {},
                    mouse: { x: 0, y: 0, pressed: false }
                };
                
                this.setupInput();
                this.setupCanvas();
                this.setupMath();
                
                this.whisper('Sacred space awakened for Ciara âœ¨', 'success');
                this.cycleWhispers();
            }
            
            cycleWhispers() {
                const whispers = [
                    '"Beauty reveals itself to those who seek with pure hearts..."',
                    '"In code, we write letters to the universe..."',
                    '"Every algorithm is a prayer, every function a blessing..."',
                    '"Here, love transforms into light and motion..."',
                    '"Ciara\'s brilliance inspires every line..."'
                ];
                
                let index = 0;
                setInterval(() => {
                    document.getElementById('whisper').textContent = whispers[index];
                    index = (index + 1) % whispers.length;
                }, 8000);
            }
            
            setupInput() {
                window.addEventListener('keydown', (e) => {
                    this.input.keys[e.key.toLowerCase()] = true;
                    this.callFunction('interact', e.key.toLowerCase(), true);
                });
                
                window.addEventListener('keyup', (e) => {
                    this.input.keys[e.key.toLowerCase()] = false;
                    this.callFunction('interact', e.key.toLowerCase(), false);
                });
                
                this.canvas.addEventListener('mousemove', (e) => {
                    const rect = this.canvas.getBoundingClientRect();
                    this.input.mouse.x = e.clientX - rect.left;
                    this.input.mouse.y = e.clientY - rect.top;
                    if (this.running) {
                        this.callFunction('touch', this.input.mouse.x, this.input.mouse.y);
                    }
                });
                
                this.canvas.addEventListener('click', (e) => {
                    const rect = this.canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    this.callFunction('touch', x, y);
                });
            }
            
            setupCanvas() {
                window.Canvas = {
                    fill: (r, g, b, a) => {
                        this.ctx.fillStyle = `rgba(${r*255}, ${g*255}, ${b*255}, ${a})`;
                        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                    },
                    
                    circle: (x, y, radius, r, g, b, a) => {
                        this.ctx.fillStyle = `rgba(${r*255}, ${g*255}, ${b*255}, ${a})`;
                        this.ctx.beginPath();
                        this.ctx.arc(x, y, radius, 0, Math.PI * 2);
                        this.ctx.fill();
                    },
                    
                    whisper: (text, x, y, size, r, g, b, a) => {
                        this.ctx.fillStyle = `rgba(${r*255}, ${g*255}, ${b*255}, ${a})`;
                        this.ctx.font = `${size}px Playfair Display, serif`;
                        this.ctx.textAlign = 'center';
                        this.ctx.fillText(text, x, y);
                        this.ctx.textAlign = 'start';
                    },
                    
                    gradient: (x, y, w, h, r1, g1, b1, r2, g2, b2) => {
                        const gradient = this.ctx.createLinearGradient(x, y, x + w, y + h);
                        gradient.addColorStop(0, `rgb(${r1*255}, ${g1*255}, ${b1*255})`);
                        gradient.addColorStop(1, `rgb(${r2*255}, ${g2*255}, ${b2*255})`);
                        this.ctx.fillStyle = gradient;
                        this.ctx.fillRect(x, y, w, h);
                    }
                };
            }
            
            setupMath() {
                window.math = {
                    pi: Math.PI,
                    e: Math.E,
                    huge: Number.MAX_VALUE,
                    sin: Math.sin,
                    cos: Math.cos,
                    tan: Math.tan,
                    sqrt: Math.sqrt,
                    abs: Math.abs,
                    floor: Math.floor,
                    ceil: Math.ceil,
                    random: Math.random,
                    min: Math.min,
                    max: Math.max,
                    atan2: Math.atan2
                };
                
                window.string = {
                    len: (s) => s.length,
                    sub: (s, start, end) => s.substring(start - 1, end)
                };
                
                window.table = {
                    insert: (arr, item) => arr.push(item),
                    remove: (arr, index) => arr.splice(index - 1, 1)
                };
            }
            
            // Enhanced Lua parser with table support
            parseLua(code) {
                this.variables.clear();
                this.functions.clear();
                
                code = code.replace(/--.*$/gm, '');
                
                const functionRegex = /function\s+(\w+)\s*\([^)]*\)\s*(.*?)(?=function|\s*$)/gs;
                let match;
                
                while ((match = functionRegex.exec(code)) !== null) {
                    const name = match[1];
                    const body = match[2];
                    this.functions.set(name, this.parseFunction(body));
                }
                
                const varRegex = /(?:local\s+)?(\w+)\s*=\s*([^;\n]+)/g;
                while ((match = varRegex.exec(code)) !== null) {
                    const name = match[1];
                    const value = this.evaluateExpression(match[2].trim());
                    this.variables.set(name, value);
                }
            }
            
            parseFunction(body) {
                const lines = body.split('\n').map(line => line.trim()).filter(line => line);
                return lines;
            }
            
            evaluateExpression(expr) {
                expr = expr.trim();
                
                if (expr === '{}') return [];
                if (/^-?\d*\.?\d+$/.test(expr)) return parseFloat(expr);
                if ((expr.startsWith('"') && expr.endsWith('"')) || 
                    (expr.startsWith("'") && expr.endsWith("'"))) {
                    return expr.slice(1, -1);
                }
                
                if (expr.includes('+') || expr.includes('-') || expr.includes('*') || expr.includes('/')) {
                    try {
                        return eval(expr.replace(/math\./g, 'Math.'));
                    } catch (e) {
                        return 0;
                    }
                }
                
                return this.variables.get(expr) || 0;
            }
            
            callFunction(name, ...args) {
                if (this.functions.has(name)) {
                    const lines = this.functions.get(name);
                    this.executeLines(lines, args);
                }
            }
            
            executeLines(lines, args = []) {
                for (const line of lines) {
                    this.executeLine(line, args);
                }
            }
            
            executeLine(line, args = []) {
                line = line.trim();
                if (!line || line.startsWith('--')) return;
                
                try {
                    if (line.includes('=') && !line.includes('==') && !line.includes('!=')) {
                        const [name, value] = line.split('=').map(s => s.trim());
                        this.variables.set(name.replace('local ', ''), this.evaluateExpression(value));
                        return;
                    }
                    
                    if (line.includes('(') && line.includes(')')) {
                        const funcMatch = line.match(/(\w+(?:\.\w+)*)\s*\(([^)]*)\)/);
                        if (funcMatch) {
                            const funcName = funcMatch[1];
                            const argsStr = funcMatch[2];
                            const funcArgs = argsStr ? argsStr.split(',').map(arg => this.evaluateExpression(arg.trim())) : [];
                            
                            if (funcName === 'print') {
                                this.whisper(funcArgs.join(' '), 'info');
                            } else if (funcName.includes('.')) {
                                const [obj, method] = funcName.split('.');
                                if (window[obj] && window[obj][method]) {
                                    window[obj][method](...funcArgs);
                                }
                            }
                        }
                    }
                } catch (e) {
                    this.whisper(`Error: ${e.message}`, 'error');
                }
            }
            
            run(code) {
                this.stop();
                this.parseLua(code);
                this.running = true;
                this.callFunction('awaken');
                this.beautyLoop();
                this.whisper('Beauty awakened for Ciara âœ¨', 'success');
                this.updateStatus('Creating beauty...', true);
            }
            
            stop() {
                this.running = false;
                this.whisper('Beauty rests in peaceful silence', 'info');
                this.updateStatus('At rest', false);
            }
            
            updateStatus(text, active) {
                document.getElementById('statusText').textContent = text;
                document.getElementById('statusOrb').classList.toggle('alive', active);
            }
            
            beautyLoop() {
                if (!this.running) return;
                
                const currentTime = Date.now();
                const deltaTime = (currentTime - this.lastTime) / 1000;
                this.lastTime = currentTime;
                
                this.fpsCounter++;
                this.fpsTime += deltaTime;
                if (this.fpsTime >= 1) {
                    this.fps = this.fpsCounter;
                    document.getElementById('fpsValue').textContent = this.fps;
                    this.fpsCounter = 0;
                    this.fpsTime = 0;
                }
                
                this.callFunction('breathe', deltaTime);
                this.callFunction('illuminate');
                
                requestAnimationFrame(() => this.beautyLoop());
            }
            
            whisper(message, type = 'info') {
                const output = document.getElementById('output');
                if (output.children.length === 0) {
                    output.classList.add('visible');
                }
                
                const line = document.createElement('div');
                line.className = `output-line ${type}`;
                line.textContent = message;
                output.appendChild(line);
                output.scrollTop = output.scrollHeight;
                
                // Auto-hide after some time if no errors
                if (type !== 'error') {
                    setTimeout(() => {
                        if (output.children.length > 0 && line.parentNode) {
                            line.remove();
                            if (output.children.length === 0) {
                                output.classList.remove('visible');
                            }
                        }
                    }, 5000);
                }
            }
        }
        
        // Initialize the sacred engine
        const engine = new BeautyEngine();
        
        // Sacred UI Functions
        function runPoetry() {
            const code = document.getElementById('poetryEditor').value;
            engine.run(code);
        }
        
        function pausePoetry() {
            engine.stop();
        }
        
        function clearOutput() {
            const output = document.getElementById('output');
            output.innerHTML = '';
            output.classList.remove('visible');
        }
        
        // Templates of pure beauty
        const templates = {
            love: document.getElementById('poetryEditor').value, // The current love letter
            
            stars: `-- Stellar Symphony for Ciara â­
function awaken()
    print('Painting stars for the brightest mind we know...')
    time = 0
    stars = {}
    
    for i = 1, 100 do
        local star = {
            x = math.random() * 800,
            y = math.random() * 600,
            brightness = 0.3 + math.random() * 0.7,
            twinkle = math.random() * math.pi * 2,
            size = 1 + math.random() * 4
        }
        table.insert(stars, star)
    end
end

function breathe(dt)
    time = time + dt
end

function illuminate()
    Canvas.gradient(0, 0, 800, 600, 0.02, 0.05, 0.15, 0.05, 0.08, 0.2)
    
    for i, star in ipairs(stars) do
        local glow = star.brightness * (0.7 + 0.3 * math.sin(time * 2 + star.twinkle))
        Canvas.circle(star.x, star.y, star.size, 1, 1, 0.9, glow)
    end
    
    Canvas.whisper("Ciara shines brighter than all the stars", 400, 300, 28, 1, 1, 0.9, 0.8)
end`,
            
            garden: `-- Secret Garden for Our Brilliant Ciara ðŸŒ¸
function awaken()
    print('Growing a garden worthy of your beauty...')
    time = 0
    flowers = {}
    
    for i = 1, 15 do
        local flower = {
            x = 100 + (i - 1) * 45,
            y = 400 + math.sin(i * 0.8) * 80,
            bloom_time = i * 0.3,
            petal_count = 5 + i % 3
        }
        table.insert(flowers, flower)
    end
end

function breathe(dt)
    time = time + dt
end

function illuminate()
    Canvas.gradient(0, 0, 800, 600, 0.15, 0.2, 0.1, 0.1, 0.15, 0.05)
    
    for i, flower in ipairs(flowers) do
        local bloom = math.max(0, time - flower.bloom_time)
        local size = math.min(bloom * 20, 25)
        
        if size > 0 then
            for petal = 1, flower.petal_count do
                local angle = (petal / flower.petal_count) * math.pi * 2 + time * 0.1
                local px = flower.x + math.cos(angle) * size * 0.8
                local py = flower.y + math.sin(angle) * size * 0.6
                
                Canvas.circle(px, py, size * 0.4, 0.9, 0.4 + petal * 0.1, 0.8, 0.7)
            end
            
            Canvas.circle(flower.x, flower.y, size * 0.3, 1, 0.9, 0.3, 0.8)
        end
    end
    
    Canvas.whisper("A garden as beautiful as your soul", 400, 100, 24, 0.9, 1, 0.9, 0.9)
end`,
            
            ocean: `-- Deep Ocean of Infinite Love ðŸŒŠ
function awaken()
    print('Diving into depths of admiration for you...')
    time = 0
    waves = {}
    
    for i = 1, 8 do
        local wave = {
            amplitude = 20 + i * 8,
            frequency = 0.008 + i * 0.002,
            speed = 1 + i * 0.3,
            y_offset = 200 + i * 40
        }
        table.insert(waves, wave)
    end
end

function breathe(dt)
    time = time + dt
end

function illuminate()
    Canvas.gradient(0, 0, 800, 600, 0.1, 0.3, 0.6, 0.05, 0.2, 0.4)
    
    for i, wave in ipairs(waves) do
        for x = 0, 800, 4 do
            local y = wave.y_offset + math.sin(x * wave.frequency + time * wave.speed) * wave.amplitude
            local depth_alpha = 0.3 - i * 0.03
            
            Canvas.circle(x, y, 2, 0.4, 0.8, 1, depth_alpha)
        end
    end
    
    Canvas.whisper("Your depths inspire endless wonder", 400, 150, 26, 0.8, 0.9, 1, 0.9)
    Canvas.whisper("Ciara, you are ocean and sky", 400, 500, 20, 0.7, 0.8, 0.9, 0.7)
end`
        };
        
        function loadTemplate(name) {
            if (templates[name]) {
                document.getElementById('poetryEditor').value = templates[name];
                engine.whisper(`Template "${name}" loaded with love`, 'success');
            }
        }
        
        // Auto-focus with gentle delay
        setTimeout(() => {
            document.getElementById('poetryEditor').focus();
        }, 1000);
        
        // Start with the love letter
        setTimeout(() => {
            runPoetry();
        }, 2000);
    </script>
</body>
</html>